var Param,Game,CoreInstanceType,Platform,__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))};class Core{constructor(e,t){if(null==t||0==t){let e=location;Core.dev=!!e&&("localhost"===location.hostname||"127.0.0.1"===location.hostname)}else Core.dev=!0;null==Core.keychain&&(Core.keychain=new Keychain),null!=e&&Core.keychain.addMethod(Keychain.getMethod(e))}static getInstance(e){return __awaiter(this,void 0,void 0,(function*(){return yield(new Call).addParam(Param.Instance,e).commit("instance/get/").then((e=>Instance.fromObject(e)))}))}static getNetwork(e){return __awaiter(this,void 0,void 0,(function*(){return yield(new Call).addParam(Param.Instance,e).commit("network/get/").then((e=>Network.fromObject(e)))}))}static getAuth(){let e=null,t=Core.keychain.getMethods();for(let r=0;r<t.length;r++){const n=t[r];if(null==e)e=n;else if(n instanceof CoreSession&&e instanceof Key){e=n;break}}return e}getPlayer(){return null!=Core.keychain.getSession()?Core.keychain.getSession().getPlayer():null}}class Keychain{addMethod(e){this.authMethods.push(e)}getSession(){for(let e=0;e<this.authMethods.length;e++){const t=this.authMethods[e];if(t instanceof CoreSession)return t}return null}getMethods(){return this.authMethods}static getMethod(e){return"string"==typeof e?new Key(e):"object"==typeof e?CoreSession.fromObject(e):void 0}}class Key{constructor(e,t,r,n,i,a){this.hash=e,this.id=t,this.type=r,this.restrict=n,this.allowedReferrers=i,this.allowedRegions=a}getCredentials(){return this.hash}getParam(){return Param.Hash}static fromObject(e){if("hash"in e){let t=new Key(String(e.hash));if("id"in e&&(t.id=String(e.id)),"restrict"in e&&(t.restrict=Boolean(e.restrict)),"allowedReferrers"in e&&(t.allowedReferrers=new Array,Array.isArray(e.allowedReferrers)))for(let r=0;r<e.allowedReferrers.length;r++){const n=e.allowedReferrers[r];t.allowedReferrers.push(RefererRestriction.fromObject(n))}if("allowedRegions"in e&&(t.allowedRegions=new Array,Array.isArray(e.allowedRegions)))for(let r=0;r<e.allowedRegions.length;r++){const n=e.allowedRegions[r];t.allowedRegions.push(RegionRestriction.fromObject(n))}return t}throw new MissingProp("hash")}}class RefererRestriction{constructor(e,t,r){this.index=e,this.domain=t,this.ip=r}static fromObject(e){let t=new RefererRestriction;return t.index=Number(e.index),t.domain=String(e.domain),t.ip=String(e.ip),t}}class RegionRestriction{constructor(e,t,r,n){this.index=e,this.country=t,this.state=r,this.city=n}static fromObject(e){let t=new RegionRestriction;return t.index=Number(e.index),t.country=String(e.country),t.state=String(e.state),t.city=String(e.city),t}}class CoreSession{constructor(e,t,r,n,i,a,o){this.owner=e,this.location=t,this.device=r,this.usage=n,this.id=i,this.hash=a,this.network=o}getCredentials(){return this.hash}getParam(){return Param.Hash}static fromObject(e){let t=new CoreSession;return"owner"in e&&(t.owner=Player.fromObject(e.owner)),"location"in e&&(t.location=SessionLocation.fromObject(e.location)),"device"in e&&(t.device=SessionDevice.fromObject(e.device)),"usage"in e&&(t.usage=SessionUsage.fromObject(e.usage)),"id"in e&&(t.id=String(e.id)),"hash"in e&&(t.hash=String(e.hash)),"network"in e&&(null!=e.network?t.network=Network.fromObject(e.network):t.network=null),t}getPlayer(){return this.owner}}class SessionDevice{constructor(e,t,r,n){this.os=e,this.device=t,this.brand=r,this.model=n}static fromObject(e){let t=new SessionDevice;return t.os=String(e.os),t.device=String(e.device),t.brand=String(e.brand),t.model=String(e.model),t}}class SessionLocation{constructor(e,t,r){this.city=e,this.state=t,this.country=r}static fromObject(e){let t=new SessionLocation;return t.city=String(e.city),t.state=String(e.state),t.country=String(e.country),t}}class SessionUsage{constructor(e,t){this.creation=e,this.uses=t}static fromObject(e){let t=new SessionUsage;return t.creation=Util.date(e.creation),t.uses=Number(e.uses),t}}class Call{constructor(){this.baseURL="https://api.purecore.io/rest/3",this.paramList=new Array}addParam(e,t){return this.paramList.push(new CallParam(e,t)),this}commit(e){return __awaiter(this,void 0,void 0,(function*(){let t={};for(let e=0;e<this.paramList.length;e++){const r=this.paramList[e];t[r.param]=r.value}let r=Core.getAuth();null!=r&&(t[r.getParam()]=r.getCredentials());let n=Call.formatEndpoint(e);const i=this.baseURL+n+"?"+Object.keys(t).filter((e=>t.hasOwnProperty(e))).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e]))).join("&");if(Core.dev){var a=t;for(const e in a)Object.prototype.hasOwnProperty.call(a,e)&&e==r.getParam()&&(a[e]="***");console.log(this.baseURL+n,a)}return new Promise(((e,t)=>fetch(i,{method:"POST"}).then((e=>e.json())).then((t=>{if("error"in t)throw new Error(t.error+". "+t.msg);e(t)})).catch((e=>t(e)))))}))}static formatEndpoint(e){return(e.startsWith("/")?"":"/")+e+(e.endsWith("/")?"":"/")}}class CallParam{constructor(e,t){this.param=e,this.value=t}}!function(e){e.Key="k",e.Hash="h",e.Session="ses",e.Code="c",e.PaymentHash="ph",e.Bank="b",e.Description="desc",e.Name="nm",e.Platform="plt",e.Cname="cnm",e.Game="gme",e.PlatformId="plid",e.PlatformName="plnm",e.Quantity="qty",e.Value="val",e.Ip="ip",e.DeviceFingerprint="dv",e.ForumCategory="fc",e.ForumEmote="fe",e.ForumObject="fo",e.ForumOpinion="fop",e.ForumPost="fp",e.ForumReaction="fr",e.ForumReply="frp",e.ForumSection="fs",e.Connection="cn",e.Connections="cs",e.Command="cmd",e.CommandExecution="cex",e.EnvSource="es",e.Host="ht",e.Image="hi",e.ImageEnv="hie",e.HostTemplate="htt",e.Instance="i",e.Instances="is",e.Network="n",e.Server="s",e.Servers="ss",e.ServerGroup="sg",e.KeyId="kid",e.Machine="m",e.Notification="not",e.Payment="p",e.Discount="d",e.Discounts="ds",e.StoreItem="si",e.StoreItems="sis",e.StoreParam="sp",e.StoreParamResponse="spr",e.StoreParamResponses="sprs",e.Perk="pk",e.Perks="pks",e.StoreCategory="sc",e.Punishment="pn",e.Appeal="a",e.Report="r",e.Offence="o",e.Offences="os",e.PunishmentAction="pa",e.VotingSite="vs",e.Ticket="t",e.TicketCategory="tc",e.TicketReply="tr",e.Player="pl",e.Profile="pp",e.NetworkPlayer="np"}(Param||(Param={}));class MissingProp extends Error{constructor(e){super(e),this.name="MissingProp"}}!function(e){e[e.Minecraft=0]="Minecraft",e[e.MinecraftBedrock=1]="MinecraftBedrock",e[e.SpaceEngineers=2]="SpaceEngineers",e[e.Unknown=-1]="Unknown"}(Game||(Game={}));class Instance{constructor(e,t,r){this.id=e,this.name=t,this.type=r}static fromObject(e){let t=new Instance;return t.id=String(e.id),t.name=String(e.name),t.type=Number(e.type),t}asNetwork(){return new Network(this.id,this.name,Game.Unknown,Platform.Unknown)}delete(){return __awaiter(this,void 0,void 0,(function*(){return yield(new Call).addParam(Param.Instance,this.id).commit("instance/delete").then((()=>{}))}))}}!function(e){e[e.Network=0]="Network",e[e.Server=1]="Server"}(CoreInstanceType||(CoreInstanceType={}));class Network{constructor(e,t,r,n){this.id=e,this.name=t,this.game=r,this.platform=n}static fromObject(e){let t=new Network;return t.name=String(e.name),t.id=String(e.id),t.game=Number(e.game),t.platform=Number(e.platform),t}asInstance(){return new Instance(this.id,this.name,CoreInstanceType.Network)}getServers(){return __awaiter(this,void 0,void 0,(function*(){return yield(new Call).addParam(Param.Network,this.id).commit("instance/group/list").then((e=>{let t=new Array;if(Array.isArray(e)){for(let r=0;r<e.length;r++){const n=e[r];t.push(ServerGroupList.fromObject(n))}return t}throw new Error("Invalid result")}))}))}createServerGroup(e){return __awaiter(this,void 0,void 0,(function*(){return yield(new Call).addParam(Param.Network,this.id).addParam(Param.Name,e).commit("instance/group/create").then((e=>ServerGroup.fromObject(e)))}))}delete(){return __awaiter(this,void 0,void 0,(function*(){return yield(new Call).addParam(Param.Instance,this.id).commit("instance/delete").then((()=>{}))}))}}!function(e){e[e.Mojang=0]="Mojang",e[e.Xbox=1]="Xbox",e[e.Steam=2]="Steam",e[e.Stadia=3]="Stadia",e[e.EpicGames=4]="EpicGames",e[e.Unknown=5]="Unknown"}(Platform||(Platform={}));class Server{constructor(e,t,r,n){this.network=e,this.id=t,this.name=r,this.group=n}static fromObject(e){let t=new Server;return t.id=String(e.id),t.name=String(e.name),t.group=null,"group"in e&&null!=e.group&&(t.group=ServerGroup.fromObject(e.group)),t}getGroup(){return this.group}setGroup(e){return __awaiter(this,void 0,void 0,(function*(){return yield(new Call).addParam(Param.Instance,this.id).addParam(Param.ServerGroup,e.getId()).commit("instance/group/set").then((e=>{let t=Server.fromObject(e);return this.group=t.getGroup(),t}))}))}ungroup(e){return __awaiter(this,void 0,void 0,(function*(){return yield(new Call).addParam(Param.Instance,this.id).commit("instance/group/unset").then((e=>{let t=Server.fromObject(e);return this.group=t.getGroup(),t}))}))}}class ServerGroupList{constructor(e,t,r,n){this.id=e,this.name=t,this.network=r,this.servers=n}static fromObject(e){let t=new ServerGroupList;if(t.id=String(e.id),t.name=String(e.name),t.network=null,"network"in e&&null!=e.network&&(t.network=Network.fromObject(e.network)),t.servers=new Array,"servers"in e&&null!=e.servers&&Array.isArray(e.servers))for(let r=0;r<e.servers.length;r++)t.servers.push(Server.fromObject(e.servers[r]));return t}}class ServerGroup{constructor(e,t,r){this.id=e,this.network=t,this.name=r}getId(){return this.id}static fromObject(e){let t=new ServerGroup;return t.id=String(e.id),t.network=null,"network"in e&&null!=e.network&&(t.network=Network.fromObject(e.network)),t.name=String(e.name),t}delete(){return __awaiter(this,void 0,void 0,(function*(){return yield(new Call).addParam(Param.Instance,this.id).commit("instance/group/delete").then((()=>{}))}))}}class Owner{getNetworks(e,t,r,n){return __awaiter(this,void 0,void 0,(function*(){return yield(new Call).addParam(Param.Name,e).addParam(Param.Cname,t).addParam(Param.Game,r).addParam(Param.Platform,n).commit("network/list/").then((e=>{if(Array.isArray(e)){let t=new Array;for(let r=0;r<e.length;r++)t.push(Network.fromObject(e[r]));return t}throw new Error("Invalid type")}))}))}createNetwork(e,t,r,n){return __awaiter(this,void 0,void 0,(function*(){return yield(new Call).addParam(Param.Name,e).addParam(Param.Cname,t).addParam(Param.Game,r).addParam(Param.Platform,n).commit("network/create/").then((e=>Network.fromObject(e)))}))}}class Player{constructor(e,t,r,n,i,a,o){this.id=e,this.creation=t,this.username=r,this.lastLogin=n,this.lastUpdated=i,this.bio=a,this.birthdate=o}static fromObject(e){let t=new Player;return"id"in e&&(t.id=String(e.id)),"creation"in e&&(t.creation=Util.date(e.creation)),"username"in e&&(t.username=String(e.username)),"lastLogin"in e&&(t.lastLogin=Util.date(e.lastLogin)),"lastUpdated"in e&&(t.lastUpdated=Util.date(e.lastUpdated)),"bio"in e&&(t.bio=String(e.bio)),"birthdate"in e&&(t.birthdate=Util.date(e.birthdate)),t}asOwner(){return new Owner}}class Util{static date(e){let t=new Date(0);return t.setUTCSeconds(e),t}}